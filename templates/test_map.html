[[extend 'layout.html']]

<!-- page_head customizes header for this page -->
[[block page_head]]
<!-- The stylesheet below is for (hosting) Leaflet 1.7.1 w/ subresource integrity enabled -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
    integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
    crossorigin="" />
[[end]]

<style>
    [v-cloak] {
        display: none;
    }
    #mapid {
        height: 700px;
    }
    table tbody {
        display: block;
        max-height: 450px;
        overflow-y: scroll;
    }
    table thead,
    table tbody tr {
        display: table;
        width: 100%;
        table-layout: fixed;
    }
    select {
        height: 40px;
        width: 75%;
        border: solid 1px;
        /*border-radius: 10px 40px 40px 10px;*/
        border-radius: 4px;
        font-size: 1em;
    }
</style>

<div class="section" id="vue-target" v-cloak>
    <div class="section">
        <h1 class="title">Search for your nearest vaccination site!</h1>
    </div>
    
    <div class="section">
        <!-- Columns for search on left and map on right -->
        <div class="columns block is-mobile">
            <!-- Column for search functionality and generated table of providers -->
            <div class="column">
                <div class="columns block is-mobile">
                    <div class="column is-half">
                        <label class="label">Zipcode (5 digits, U.S. only)</label>
                    </div>
                    <div class="column is-half">
                        <label class="label">Search Radius</label>
                    </div>
                </div>
                <!-- <label class="label">Zipcode (5 digits, U.S. only)</label> -->
                <!-- Nested column for zipcode field -->
                <div class="columns block is-mobile">
                    <div class="column is-one-quarter">
                        <div class="field">
                            <div class="control has-icons-left">
                                <input type="text" placeholder="Enter a Zipcode" v-model="zipcode" class="input">
                                <span class="icon is-small is-left">
                                    <i class="fa fa-map-marker"></i>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="column is-one-quarter"></div>
                    <!-- Field for search radius -->
                    <div class="column is-one-quarter">
                        <div class="field">
                            <!--<div class="control"><input type="text" placeholder="Range" v-model="range" class="input">
                                                                </div> -->
                            <div class="control">
                                <!-- Single-select drop down menu for search radius in miles -->
                                <select v-model="range">
                                    <!-- :value"{}" -- inline object literal; strings are bound to numbers -->
                                    <option :value="{ number: 1 }">
                                        <p>1 mile</p>
                                    </option>
                                    <option :value="{ number: 5 }"><span>5 miles</span></option>
                                    <option :value="{ number: 10 }"><span>10 miles</span></option>
                                    <option :value="{ number: 25 }"><span>25 miles</span></option>
                                    <option :value="{ number: 50 }"><span>50 miles</span></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="field">
                    <div class="control">
                        <input type="submit" @click="search" value="Search" class="button is-success">
                    </div>
                </div>
                <!-- Table -->
                <table v-if="page_initialized" class="table is-fullwidth is-narrow is-hoverable">
                    <thead>
                        <tr>
                            <th>Provider</th>
                            <th>Address</th>
                            <th>City</th>
                            <th>Distance (miles)</th>
                            <th>In Stock</th>
                            <th>Rating</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="r in rows">
                            <td>{{r.provider}}</td>
                            <td>{{r.address}}</a></td>
                            <td>{{r.city}}</td>
                            <td>{{r.distance}}</td>
                            <td>{{r.availability}}</td>
                            <td>
                                <span v-for="star_idx in [1, 2, 3, 4, 5]">
                                  <i v-if="star_idx <= r.rating" class="fa fa-star fa-xs"></i>
                                  <i v-if="star_idx > r.rating" class="fa fa-star-o fa-xs"></i>
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
        </div>
        <div class="column is-7">
            <div id="mapid"></div>
        </div>
    </div>
</div>

[[block page_scripts]]
<!-- The script below is for (hosting) Leaflet 1.7.1 w/ subresource integrity enabled -->
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
    integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
    crossorigin=""></script>
<script src="https://code.jquery.com/jquery-3.5.0.js"></script>
<script>let api_key = "[[=API_KEY]]"; let user_id = "[[=USER_ID]]"; let load_ratings_url = "[[=XML(load_ratings_url)]]";</script>
<script src="js/test_map.js"></script>

[[end]]
